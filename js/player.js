"use strict";function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,s){for(var i=0;i<s.length;i++){var h=s[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}return function(s,i,h){return i&&t(s.prototype,i),h&&t(s,h),s}}(),Player=function(){function t(s){_classCallCheck(this,t),this.damage=5+s.atk*s.atk+2*s.atkB,this.speed=2+s.speed*s.speed*.2,this.maxHp=200+s.hp*s.hp*50,this.atr=500+s.atr*s.atr*50,this.coe=0===s.atkB?1:2-.3*s.atkB,this.cri=s.cri*s.cri*.1,this.nb=0+2*s.nb,this.rate=1-.1*s.rate,this.thump=s.thump,this.shot=0+s.vast+s.num,this.hurt=2+2*s.hurt,this.name="archer",this.img=[],this.status="",this.status1="",this.scratchNum=0,this.hp=this.maxHp,this.w=250,this.h=250,this.x=.5*document.getElementById("canvas").width,this.y=.5*document.getElementById("canvas").height,this.canFire=!0,this.angle=0,this.scratchImg=new Image,this.hpImg=new Image,this.imgsStand=[],this.imgsStandAll=50,this.standNow=0,this.imgsRunFoot=[],this.imgsRunFootAll=33,this.runFootNow=0,this.imgsRunHead=[],this.imgsRunHeadAll=33,this.runHeadNow=0,this.imgsAtk=[],this.imgsAtkAll=39,this.atkNow=0,this.imgStandFoot=new Image,this.atk=0,this.init()}return _createClass(t,[{key:"init",value:function(){this.creatImgs()}},{key:"draw",value:function(){this.move();var t=c.my-this.y,s=c.mx-this.x;this.angle=Math.atan2(t,s)+Math.PI/2,this.imgFn(),c.ctx.save(),c.ctx.translate(this.x,this.y),c.ctx.rotate(this.angle);for(var i=0;i<this.img.length;i++)c.ctx.drawImage(this.img[i],.5*-this.w,.5*-this.h,this.w,this.h);return c.ctx.restore(),this.showHp(),this.hp<=0?void c.gameOver():void this.showScratch()}},{key:"move",value:function(){c.keySet.size?(this.status="run",c.keySet.has("l")&&(1==c.keySet.size?this.x-=this.speed:this.x-=this.speed/2*Math.sqrt(2),this.x<0&&(this.x=0)),c.keySet.has("r")&&(1==c.keySet.size?this.x+=this.speed:this.x+=this.speed/2*Math.sqrt(2),this.x>c.canWidth&&(this.x=c.canWidth)),c.keySet.has("t")&&(1==c.keySet.size?this.y-=this.speed:this.y-=this.speed/2*Math.sqrt(2),this.y<0&&(this.y=0)),c.keySet.has("b")&&(1==c.keySet.size?this.y+=this.speed:this.y+=this.speed/2*Math.sqrt(2),this.y>c.canHeight&&(this.y=c.canHeight))):this.status="stand"}},{key:"reFire",value:function(){var t=this;setTimeout(function(){t.canFire=!0},1e3*this.rate)}},{key:"showScratch",value:function(){0!==this.scratchNum&&(1===this.scratchNum&&(au.volume=1,au.src="../audio/hurt.mp3"),c.ctx.save(),c.ctx.translate(this.x,this.y),c.ctx.drawImage(this.scratchImg,0,0,214,100,-25,-12,50,25),c.ctx.restore(),this.scratchNum++,this.scratchNum>30&&(this.scratchNum=0))}},{key:"showHp",value:function(){this.hp<0&&(this.hp=0),c.ctx.save(),c.ctx.translate(this.x,this.y),c.ctx.drawImage(this.hpImg,0,0,55,8,-50,-50,100,6),c.ctx.drawImage(this.hpImg,55,0,54,8,-50,-50,this.hp/this.maxHp*100,6),c.ctx.restore()}},{key:"imgFn",value:function(){"stand"===this.status?"atk"===this.status1?(this.img=[this.imgStandFoot,this.imgsAtk[this.atkNow]],this.atkNow++,10===this.atkNow&&(au.volume=1,au.src="../audio/p-atk.mp3"),this.atkNow===this.imgsAtkAll&&(this.status1="")):(this.img=[this.imgsStand[this.standNow]],this.standNow++,this.standNow%=this.imgsStandAll):"run"===this.status&&("atk"===this.status1?(this.img=[this.imgsRunFoot[this.runFootNow],this.imgsAtk[this.atkNow]],this.runFootNow++,this.runFootNow%=this.imgsRunFootAll,this.atkNow++,10===this.atkNow&&(au.volume=1,au.src="../audio/p-atk.mp3"),this.atkNow===this.imgsAtkAll&&(this.status1="")):(this.img=[this.imgsRunFoot[this.runFootNow],this.imgsRunHead[this.runHeadNow]],this.runFootNow++,this.runFootNow%=this.imgsRunFootAll,this.runHeadNow++,this.runHeadNow%=this.imgsRunHeadAll))}},{key:"creatImgs",value:function(){for(var t=0;t<this.imgsStandAll;t++){var s=new Image;s.src="../img/canvas/hero/"+this.name+"/stand/"+t+".png",this.imgsStand.push(s)}for(var t=0;t<this.imgsRunFootAll;t++){var s=new Image;s.src="../img/canvas/hero/"+this.name+"/runFoot/"+t+".png",this.imgsRunFoot.push(s)}for(var t=0;t<this.imgsRunHeadAll;t++){var s=new Image;s.src="../img/canvas/hero/"+this.name+"/runHead/"+t+".png",this.imgsRunHead.push(s)}for(var t=0;t<this.imgsAtkAll;t++){var s=new Image;s.src="../img/canvas/hero/"+this.name+"/atk/"+t+".png",this.imgsAtk.push(s)}this.imgStandFoot.src="../img/canvas/hero/"+this.name+"/standFoot/0.png",this.scratchImg.src="../img/canvas/ico/scratch.png",this.hpImg.src="../img/canvas/hero/hp.png"}}]),t}();